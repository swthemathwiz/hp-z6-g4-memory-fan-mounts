# hp-z6-g4-memory-fan-mounts

## Introduction

These are 3D-Printable [OpenSCAD](https://openscad.org/) models to mount
memory fans in an HP Z6 G4 workstation. These are in no way endorsed by
HP. Also, the author is not responsible for any damage resulting from
their use.

<p align="center"><img src="../media/media/hp-z6-memory-fan-mount-dual-80-80x25.installed.jpg" alt="HP Z6 G4 with Dual Front Fan Mount"  height="350px" /></p>

The mounts aren't an exact replacements for HP's fans or memory shroud;
they do not guarantee sufficient air flow in all cases; they have not
been tested under most conditions. The dual mount is also a tight fit,
and if you use the upper 5 1/4" drive area it may be impossible to use.
Also, it doesn't work with a second CPU. Finally, it can make it more
difficult to disassemble and reassemble your machine on a frequent
basis. In all these cases, you may wish to go in a different direction.
With all that said, if you wish to add a couple DIMMs or increase your
memory size past 32GB on a single CPU setup, it's probably sufficient.
Use your own judgment.

If you attempt to boot a larger memory configuration and are missing a fan or two,
the relevant HP Post Error messages you may encounter are:

- **517 Memory configuration requires a Memory fan and this fan is not detected**: You
need a fan connected to the rear (shroud) connector
- **520 Memory configuration requires Memory fan(2) and this fan is not detected**: You
need a fan connected to the front connector

Adding fan(s) may workaround these problems. You can do it without
modifications to your motherboard or cabling by adding the appropriate
single or dual mount. Alternatively, You can also use the cable without
the mount to add a second fan elsewhere.

## Model and Parts

Four models are produced:

<div class="model" data-name="HP Z6 G4 Single 80 Memory Fan Mount" data-icon-size="128" data-right="hp-z6-memory-fan-mount-single-80.installed.jpg" data-left-icon="hp-z6-memory-fan-mount-single-80.icon.png" data-left="hp-z6-memory-fan-mount-single-80.stl"><!-- expanded by annotate-model --><table align="center" width="100%"><tbody><tr width="100%"><td align="center" width="160" height="160"><a href="../media/media/hp-z6-memory-fan-mount-single-80.stl" target="_blank" title="View HP Z6 G4 Single 80 Memory Fan Mount Model"><img src="../media/media/hp-z6-memory-fan-mount-single-80.icon.png" alt="HP Z6 G4 Single 80 Memory Fan Mount Model" width="128" height="128" /></a></td><td>

### HP Z6 G4 Single 80 Memory Fan Mount

Replacement fan mount for the HP front memory fan. It is installed just
like the OEM mount between the drive cage and the motherboard in the
middle part of an HP Z6 G4 workstation.

</td><td align="center" width="160" height="160"><a href="../media/media/hp-z6-memory-fan-mount-single-80.installed.jpg" target="_blank" title="View HP Z6 G4 Single 80 Memory Fan Mount Installed"><img src="../media/media/hp-z6-memory-fan-mount-single-80.installed.jpg" alt="HP Z6 G4 Single 80 Memory Fan Mount Installed" width="128" height="128" /></a></td></tr></tbody></table></div>

<div class="model" data-name="HP Z6 G4 Dual 80/80x20 Memory Fan Mount" data-icon-size="128" data-right="hp-z6-memory-fan-mount-dual-80-80x20.installed.jpg" data-left-icon="hp-z6-memory-fan-mount-dual-80-80x20.icon.png" data-left="hp-z6-memory-fan-mount-dual-80-80x20.stl"><!-- expanded by annotate-model --><table align="center" width="100%"><tbody><tr width="100%"><td align="center" width="160" height="160"><a href="../media/media/hp-z6-memory-fan-mount-dual-80-80x20.stl" target="_blank" title="View HP Z6 G4 Dual 80/80x20 Memory Fan Mount Model"><img src="../media/media/hp-z6-memory-fan-mount-dual-80-80x20.icon.png" alt="HP Z6 G4 Dual 80/80x20 Memory Fan Mount Model" width="128" height="128" /></a></td><td>

### HP Z6 G4 Dual 80/80x20 Memory Fan Mount

Replaces the single front memory fan with a dual 80-mm fan setup. The
secondary fan width is 20 mm which allows a little breathing room at the
rear of the mount if you have disk caddies installed.  Installed in the
area between the drive area and motherboard on an HP Z6 G4 workstation.
The secondary fan hangs off the primary memory fan and is centered close
to the set of DIMMs between the CPU and PSU. Note that this is a wide
model - a little less than 200 mm.

</td><td align="center" width="160" height="160"><a href="../media/media/hp-z6-memory-fan-mount-dual-80-80x20.installed.jpg" target="_blank" title="View HP Z6 G4 Dual 80/80x20 Memory Fan Mount Installed"><img src="../media/media/hp-z6-memory-fan-mount-dual-80-80x20.installed.jpg" alt="HP Z6 G4 Dual 80/80x20 Memory Fan Mount Installed" width="128" height="128" /></a></td></tr></tbody></table></div>

<div class="model" data-name="HP Z6 G4 Dual 80/80x25 Memory Fan Mount" data-icon-size="128" data-right="hp-z6-memory-fan-mount-dual-80-80x25.installed.jpg" data-left-icon="hp-z6-memory-fan-mount-dual-80-80x25.icon.png" data-left="hp-z6-memory-fan-mount-dual-80-80x25.stl"><!-- expanded by annotate-model --><table align="center" width="100%"><tbody><tr width="100%"><td align="center" width="160" height="160"><a href="../media/media/hp-z6-memory-fan-mount-dual-80-80x25.stl" target="_blank" title="View HP Z6 G4 Dual 80/80x25 Memory Fan Mount Model"><img src="../media/media/hp-z6-memory-fan-mount-dual-80-80x25.icon.png" alt="HP Z6 G4 Dual 80/80x25 Memory Fan Mount Model" width="128" height="128" /></a></td><td>

### HP Z6 G4 Dual 80/80x25 Memory Fan Mount

Like the Dual 80/80x20, replaces the single front memory fan with a dual
80-mm fan setup. The secondary fan housing accommodates a 25-mm width
fan. This places the rear of the mount (and 25-mm width fan intake)
very close to the rear of the disk caddies.

</td><td align="center" width="160" height="160"><a href="../media/media/hp-z6-memory-fan-mount-dual-80-80x25.installed.jpg" target="_blank" title="View HP Z6 G4 Dual 80/80x25 Memory Fan Mount Installed"><img src="../media/media/hp-z6-memory-fan-mount-dual-80-80x25.installed.jpg" alt="HP Z6 G4 Dual 80/80x25 Memory Fan Mount Installed" width="128" height="128" /></a></td></tr></tbody></table></div>

<div class="model" data-name="Countersunk Washers" data-icon-size="128" data-right="hp-z6-memory-fan-mount-washers.installed.jpg" data-left-icon="hp-z6-memory-fan-mount-washers.icon.png" data-left="hp-z6-memory-fan-mount-washers.stl"><!-- expanded by annotate-model --><table align="center" width="100%"><tbody><tr width="100%"><td align="center" width="160" height="160"><a href="../media/media/hp-z6-memory-fan-mount-washers.stl" target="_blank" title="View Countersunk Washers Model"><img src="../media/media/hp-z6-memory-fan-mount-washers.icon.png" alt="Countersunk Washers Model" width="128" height="128" /></a></td><td>

### Countersunk Washers

This is a set of 4 countersunk washers used to secure fans in the mounts
using fan screws. They make the fan screws flush.

</td><td align="center" width="160" height="160"><a href="../media/media/hp-z6-memory-fan-mount-washers.installed.jpg" target="_blank" title="View Countersunk Washers Installed"><img src="../media/media/hp-z6-memory-fan-mount-washers.installed.jpg" alt="Countersunk Washers Installed" width="128" height="128" /></a></td></tr></tbody></table></div>

## A Note on HP Workstation 4-Pin Fan Connectors

The "standard" 4-pin HP Workstation fan connector is somewhat proprietary mechanically. Older fans tend
to have four color-coded wires and a reddish-brown connector (e.g. [JWT A2548H00-4P](http://www.jwt.com.tw/pro_pdf/A2548.pdf)).
Newer fans come with black wires and a white connector (e.g. [Molex 22-01-3047](https://www.molex.com/en-us/products/part-detail/22013047)).
These connectors are polarized - both ends of the connector have small ribs. They differ from
4-pin PC-style PWM fans which have a 3+1 keying (see [Molex 47054-1000](https://www.molex.com/en-us/products/part-detail/470541000)).

Electrically, PC- and HP-style signals are compatible and are in the
same order: Ground, +12 VDC, RPM Sense, PWM Control.

If you want to connect a PC-style PWM fan to an HP-style motherboard
header, you need to modify the connector. You can do this either by
shaving the middle key on the PC-style connector or by transplanting the
terminals to an HP-style connector.

## What You'll Need for the Single Mount <a name="primary"/>

If you're missing a front memory fan, then you'll need a fan. Otherwise, you can
reuse the existing fan and get case fan screws.

### An HP-Compatible 80-mm Fan <a name="fan80x25"/>

<img src="../media/media/fan.jpg" alt="Fan" align="right" width="250px" height="250px" />

Generally, if you don't have a stock front memory fan, you'll want to
buy (or scavenge) an HP-compatible 80 mm x 25 mm PWM +12 VDC fan that
has an HP-specific 4-pin connector and a cable length of about 3 inches
or more.

The stock fan is a Foxconn PVA080G12Q (0.65A max, 0.35A nominal) (HP:
907246-001) +12 VDC PWM fan. Note that this fan is very common on ebay
with PC-style connector, so make sure you know what you're getting into.
80-mm fans with the HP-style connector seem somewhat rare, so you might
be stuck ordering a stock fan. Some 80-mm fans I spotted with an
HP-style connector:

- AVC DL08025R12U (0.50A) from HP 400 G3 SFF series (both styles)
- FOXCONN PVA080G12R (0.80A) (various styles)

I reused the stock fan and have not tested any other fans as a primary
memory fan.

### Four Case Fan Screws <a name="screws"/>

<img src="../media/media/screws.jpg" alt="Case Fan Screws" align="right" width="60px" height="60px" />

These seem more or less standard - silver or black, about 10 mm in
length, very coarse thread. Make sure these are on the long side since
they have to go through 4 mm of plastic instead of <1 mm of metal
before reaching the fan.

## What You'll Need for the Dual Mount <a name="secondary"/>

The dual mount adds an additional secondary fan that hangs off the
primary mount. So in addition to everything necessary for the [single
mount](#primary), you'll be adding a second fan connected to a fan
adapter cable - a cable which you'll have to build.

### A Second 80-mm Fan

For reference, the HP Z6 memory shroud contains a single blower-style
fan. The OEM fan is a Foxconn PVB090G12L-P01-AB +12 VDC (0.88A max,
0.70A nominal) 90-mm PWM Fan (HP: 907245-001).

With a 25-mm width fan, the rear of the secondary fan ends up very close
to the rear of the disk caddies (~1 mm), so you may prefer to use a
20-mm width fan. In any case, choose a secondary fan with a cable long
enough to reach your fan adapter cable (about 6 inches with my
constructed fan adapter cable).

For an 80x80x25 mm secondary fan, the Foxconn PVA080G12Q matches the
primary fan, with a PC- or HP-style connector, and seems like a safe and
obvious choice. They are cheap and plentiful on ebay. Other choices are
listed [above](#fan80x25).

For an 80x80x20 mm secondary fan, the Foxconn PVA080F12R (0.36A) / AVC DASA0820R2U
(0.60A) +12 VDC PWM fan (both Dell: 05NPYY) with a PC-style connector is
cheap and plentiful on ebay.

I tested both the Foxconn PVA080G12Q and PVA080F12R as secondary
fans and both worked well. I preferred the 20-mm width for the spacing.

### Four More Case Fan Screws

See above for recommendations on the [case fan screws](#screws).

### Fan Adapter Cable <a name="cable"/>

This information was taken or derived partially from:
[u/chestertonfan](https://www.reddit.com/r/HSpecWorkstations/comments/1aovkmw/hp_z6_g4_ram_upgrade_and_how_to_prevent_memory/),
[Doug Lomax](https://www.youtube.com/watch?v=z3HnZJ8g-cU), and
[Snoopmasta](https://h30434.www3.hp.com/t5/Business-PCs-Workstations-and-Point-of-Sale-Systems/PIN-out-of-Z440-memory-fan-connector/td-p/9013593).

The connector on the motherboard for the second memory fan is intended
to attach to the HP Z6 G4 Memory Shroud (HP: 2HW44AA, 916799-001).
Mechanically it is, of course, nonstandard.

<a name="pinout"/>

The motherboard's 4-pin (2x2) box header is from the [Molex Micro Fit 3.0](https://www.molex.com/en-us/products/connectors/wire-to-board-connectors/micro-fit-connectors) family
and is actually a Blind-Mate Interface (BMI) part [Molex 44432-0401](https://www.molex.com/en-us/products/part-detail/444320401),
which makes the part on the shroud [Molex 44133-0400](https://www.molex.com/en-us/products/part-detail/441330400).
The location and pin-out are as follows (all pictures oriented in the same
direction - left = case rear, up = case top):

<p align="center"><img src="../media/media/pinout.jpg" alt="Z6 Shroud MEMFAN Pinout" height="350px" /></p>

We can connect a 2x2 [Molex 43025-0400](https://www.molex.com/en-us/products/part-detail/430250400)
to the header and bring the signals out to a "standard" fan connector by
building a cable. Because the header is a BMI part, it is not designed
for locking so you'll need to remove the connector's lock to insert it.
The connector is polarized correctly to the mating part; it fits in only
one orientation. It seems reasonably secure without the lock.

I purchased a pre-crimped Molex Micro-Fit 3.0 pig-tail cable and crimped
a 4-Pin fan housing on to the other end using parts from Aliexpress:

<img src="../media/media/cable-parts.jpg" alt="Z6 G4 Shroud MEMFAN to Fan Cable Parts" align="right" height="200px" />

- [2x2P - Molex 3.0MM Micro-Fit Male](https://www.aliexpress.com/item/3256801843724035.html):
  Pre-crimped with 20 cm of wiring (a couple inches more would have been better). Note that
  a couple of the terminals were not fully seated and needed to be pushed in.
- [Molex 2540 3+1 Pin Black Fan Male](https://www.aliexpress.com/item/2255799913539129.html):
  Shielded PC-style PWM fan housing and crimp pins. It also
  accepts the HP-style fan connectors. The housing is [LHE C2505-HB04 / 5240B-4A](https://www.lhecn.com/wp-content/uploads/2019/01/C2505C250652405102-1.pdf)
  and is sometimes referred incorrectly as Molex 2540.

Cut off the lock on the Molex connector, observe the orientation of the
connector when plugged in to the motherboard, and map the pin numbering
to the above pinout (for me, Motherboard {1,2,3,4} → Wire {Black, Red,
White, Yellow} → Fan {Ground, +12 VDC, RPM Sense, PWM Control}) based on
the header [pinout](#pinout).  Crimp on the fan connectors, insert the
pins into the fan housing in the correct positions ([PWM fan reference pinout](https://allpinouts.org/pinouts/connectors/motherboards/motherboard-cpu-4-pin-fan/)),
and you get something like this:

<p align="center"><img src="../media/media/cable.jpg" alt="Z6 G4 Shroud MEMFAN to Fan Cable" height="200px" /></p>

Test your cable by connecting a known-working 4-pin PWM fan to the
motherboard. The Z6's BIOS automatically detects the fan from the RPM
Sense input.

On Linux kernel > 6.5, verify fan presence detect and RPM by using
lm-sensors and the [hp-wmi-sensors module](https://www.phoronix.com/news/HP-WMI-Sensors-Linux-Driver).
"Memory Fan0" is for the fan connected to the shroud header and
"Memory Fan1" is for the front fan:

```shell
% sudo modprobe hp-wmi-sensors
% sensors
...
hp_wmi_sensors-virtual-0
Adapter: Virtual device
CPU0 Fan:                   4580 RPM
Rear Chassis Fan0:          2945 RPM
Front Chassis Fan0:         2426 RPM
Memory Fan0:                2614 RPM
Memory Fan1:                4501 RPM
...
```

On Windows, install the [HP Performance Advisor](https://www.hp.com/us-en/workstations/performance-advisor.html)
software and verify the fan presence by looking for "Memory Fan0"
presence and RPM under "Your Computer" → "System Sensors".

## Printing

For the washers, print from PLA with a **layer height of 0.12 mm** and
**infill density of 50%** or higher. Print one set of washers per fan.

For the mounts, print from PLA with a **layer height of 0.2 mm** and
**infill density of 20%** with **support generation**. In Cura, I set
"Support Placement" to "Touching Build Plate" and "Support Overhang
Angle" set to 45 degrees (the default). After printing, remove the
generated supports (at least 4 pieces: two under the bottom tangs, two
under the top tabs) and clean-up the print with utility knife.

## Installation

1.  Set your computer on its side and open up the side.

2.  Remove the existing front memory mount and fan. Refer to the
    [HP Z6 G4 Maintenance and Service Guide](https://support.hp.com/us-en/product/setup-user-guides/hp-z6-g4-workstation/16449901),
    page 27. Take note of the fan orientation (fan label forward)
    and cable routing. Once out the case, if you want to reuse
    the OEM 80-mm fan, it unclips easily from the rear of the OEM mount.
    There is no need to remove the rear fan guard from the OEM fan.

3.  For a dual setup, rearrange any cable flow between the 5 1/4" drive bays
    and the motherboard to open up space. For example, push unused drive
    and CD-ROM power cables into the drive bays. Essentially, create a
    hole in the area that fits the secondary fan.

    <p align="center"><img src="../media/media/clean-out.jpg" alt="Create a Hole" height="200px" /></p>

    If you're building a dual setup, you should probably check your
    electrical cabling prior to assembly. Also, it's not a bad idea
    to trial fit your 3D-printed part at this point, prior to adding
    fans, etc..

    <p align="center"><img src="../media/media/inspection.jpg" alt="Case and Mount Connections" height="350px" /></p>

4.  Assembly the new mount with your 3D-printed part:

    - Insert fans from back (fan labels forward), ensuring that the
      cables are routed nearest to connectors.
    - Screw fans to the front of the mount with case fan screws thru countersunk washers.

    <p align="center"><img src="../media/media/hp-z6-memory-fan-mount-dual-80-80x25.assembled.jpg" alt="Fan with Mount Assembled" height="350px" /></p>

5.  Install the mount in the computer. If you removed the OEM fan, then
    the installation is essential the reverse. The easiest sequence seems
    to be tilt the mount slightly forward, insert the bottom tangs in the
    cases slots, push the top tabs down a little and push the top tabs into
    the top slots. Verify a tight and secure fit.

    <p align="center"><img src="../media/media/hp-z6-memory-fan-mount-dual-80-80x25.installed.jpg" alt="Fan with Mount Installed"  height="350px" /></p>

6.  For added security, you can add a twist-tie (or wire) from the
    mount to the case at one of these locations: through the top
    thumbnail holes in the top of the primary fan mount, through the holes
    in top sides of each fan mount, or around the mount's bridge between
    a dual fan setup.

7.  Plug in the fan(s), reattach any hardware, power on and enjoy the cool breeze
    of the memory fans in your HP Z6\! If you want to test higher fan speeds,
    reboot into the BIOS Setup → Advanced → Built-In Device Options → Increase Idle Fan
    Speed(%) → 100 to create a small tornado :tornado:.

## Source

The fan mounts are built using OpenSCAD.
*hp-z6-memory-fan-mount-single-80.scad* is the main file for the single fan model.
*hp-z6-memory-fan-mount-dual-80-80x25.scad* and *hp-z6-memory-fan-mount-dual-80-80x20.scad* build
dual fan models with secondary fan sizes of 80x80x25 mm and 80x80x20 mm.
*hp-z6-memory-fan-mount-washers.scad* builds the washers.
Most of the code and settings are found in *hp-z6-memory-fan-mounts.scad* with the
main files only selecting which model is built.

### Fan Models

Models are used to visualize and verify the relative positions of holes
and mounts during debugging but not necessary for building. This project
uses 80-mm fan model created from [Delta](https://www.delta-fan.com) fan
models. The fan models were converted from STEP to stl format using
[IMAGEtoSTL](https://imagetostl.com/convert/file/stp/to/stl). The full
set of fan models referenced in the source are:

- 80 mm x 25 mm Fan: file _Delta-AFB0812HH.STL_ from [Delta AFB0812HH](https://www.delta-fan.com/AFB0812HH.html)
- 80 mm x 20 mm Fan: file _Delta-AFB0812HHD-A.STL_ from [Delta AFB0812HHD-A](https://www.delta-fan.com/AFB0812HHD-A.html)
- 80 mm x 15 mm Fan: file _Delta-AFB0812HB.STL_ from [Delta AFB0812HB](https://www.delta-fan.com/AFB0812HB.html)
- 92 mm x 25 mm Fan: file _Delta-AFB0912HH.STL_ from [Delta AFB0912HH](https://www.delta-fan.com/AFB0912HH.html)
- 120 mm x 25 mm Fan: file _Delta-AFB1212HH.STL_ from [Delta AFB1212HH](https://www.delta-fan.com/AFB1212HH.html)

## Also Available on Thingiverse

STLs are available on [Thingiverse](https://www.thingiverse.com/thing:).
